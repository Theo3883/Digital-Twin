@page "/profile"
@inject IAuthApplicationService AuthService
@inject NavigationManager Navigation

<RequireAuth>
    <div class="page-enter" style="display: flex; flex-direction: column; gap: 16px; max-width: 600px; margin: 0 auto;">

        @if (_currentUser is not null)
        {
            <MudCard Class="glass-card" Elevation="0">
                <MudCardContent>
                    <MudStack Spacing="4" AlignItems="AlignItems.Center">
                        <MudAvatar Size="Size.Large" Style="border: 3px solid rgba(0, 212, 200, 0.4);">
                            @if (!string.IsNullOrEmpty(_currentUser.PhotoUrl))
                            {
                                <MudImage Src="@_currentUser.PhotoUrl" Alt="@_currentUser.DisplayName" />
                            }
                            else
                            {
                                <MudText Typo="Typo.h3">@_currentUser.DisplayName.FirstOrDefault()</MudText>
                            }
                        </MudAvatar>
                        <MudText Typo="Typo.h6" Style="color: var(--text-main);">@_currentUser.DisplayName</MudText>
                        <MudText Typo="Typo.body2" Style="color: var(--text-sec);">@_currentUser.Email</MudText>
                    </MudStack>
                </MudCardContent>
            </MudCard>

            <MudCard Class="glass-card" Elevation="0">
                <MudCardContent>
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Error"
                               FullWidth="true"
                               OnClick="SignOutAsync"
                               Style="text-transform: none; font-weight: 600;">
                        Log out
                    </MudButton>
                </MudCardContent>
            </MudCard>
        }
    </div>
</RequireAuth>

@code {
    private AuthResultDto? _currentUser;

    protected override async Task OnInitializedAsync()
    {
        _currentUser = await AuthService.GetCurrentUserAsync();
    }

    private async Task SignOutAsync()
    {
        await AuthService.SignOutAsync();
        _currentUser = null;
        Navigation.NavigateTo("/login");
    }
}
